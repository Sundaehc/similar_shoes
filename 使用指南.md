# 使用指南 (Usage Guide)

## 快速开始 (Quick Start)

### 1. 准备图片
将鞋子图片放在一个文件夹中，例如：
```
E:\shoes\factory_a\
├── shoe1.jpg
├── shoe2.jpg
├── shoe3.jpg
└── ...
```

### 2. 运行程序
```bash
python main.py E:\shoes\factory_a
```

### 3. 查看结果
程序会在 `output` 文件夹中生成结果：
- `similar_groups/` - 相似款分组（每个文件夹包含所有相似的鞋子）
- `unique/` - 独特款式（不属于任何相似组）

## 常用命令 (Common Commands)

### 基础运行
```bash
python main.py <图片文件夹>
```

### 指定输出文件夹
```bash
python main.py <图片文件夹> -o <输出文件夹>
```

### 跳过背景移除（更快）
```bash
python main.py <图片文件夹> --no-bg-removal
```

### 调整相似度阈值
```bash
# 更严格的重复判定（0.97）
python main.py <图片文件夹> --duplicate-threshold 0.97

# 更宽松的相似判定（0.80）
python main.py <图片文件夹> --similar-threshold 0.80
```

## 阈值调整建议 (Threshold Tuning)

### duplicate-threshold (重复阈值)
- **0.98-1.0**: 几乎完全相同（同一双鞋的不同角度）
- **0.95-0.98**: 极度相似（可能是同款不同配色）
- **0.90-0.95**: 高度相似（版型相同但细节不同）

### similar-threshold (相似阈值)
- **0.90-0.95**: 非常相似的款式
- **0.85-0.90**: 相似的设计风格（推荐）
- **0.80-0.85**: 同类型但有明显差异

## 实际使用流程 (Workflow)

### 场景：处理多个鞋厂的图片

1. **组织文件夹**
```
shoes/
├── factory_a/
│   ├── shoe1.jpg
│   └── ...
├── factory_b/
│   ├── shoe1.jpg
│   └── ...
└── factory_c/
    ├── shoe1.jpg
    └── ...
```

2. **批量处理**
```bash
# 处理鞋厂A
python main.py shoes/factory_a -o results/factory_a

# 处理鞋厂B
python main.py shoes/factory_b -o results/factory_b

# 处理鞋厂C
python main.py shoes/factory_c -o results/factory_c
```

3. **查看结果**
- 打开 `results/factory_a/representatives/` 查看代表款
- 查看 `summary.json` 了解处理统计
- 检查 `duplicates/` 和 `similar/` 文件夹中的分组

4. **调整阈值（如果需要）**
如果发现：
- 太多重复：提高 `--duplicate-threshold` 到 0.97
- 太少分组：降低 `--similar-threshold` 到 0.80

## 性能优化 (Performance Tips)

### 加快处理速度
1. 使用 `--no-bg-removal` 跳过背景移除
2. 如果有GPU，程序会自动使用（快5-10倍）
3. 分批处理大量图片

### 处理时间参考
- CPU: 约 5-10秒/张
- GPU: 约 1-2秒/张
- 100张图片: CPU约10-15分钟，GPU约2-3分钟

## 输出结构 (Output Structure)

```
output/
├── similar_groups/              # 相似款分组
│   ├── duplicate_group_0000/    # 重复款组（相似度≥0.95）
│   │   ├── rep_shoe1.jpg        # 代表款（带rep前缀）
│   │   ├── sim_0.972_shoe2.jpg  # 相似款（带相似度分数）
│   │   ├── sim_0.968_shoe3.jpg
│   │   └── group_info.json      # 组信息
│   ├── similar_group_0001/      # 相似款组（相似度0.85-0.95）
│   │   ├── rep_shoe5.jpg
│   │   ├── sim_0.891_shoe6.jpg
│   │   └── group_info.json
│   └── ...
├── unique/                      # 独特款式（不属于任何组）
│   ├── shoe10.jpg
│   └── shoe15.jpg
└── summary.json                 # 处理摘要
```

### 文件夹说明

1. **similar_groups/** - 所有相似款分组
   - `duplicate_group_xxxx/` - 极度相似的鞋子（几乎重复）
   - `similar_group_xxxx/` - 相似但有差异的鞋子
   - 每个文件夹包含该组的所有鞋子
   - 代表款文件名带 `rep_` 前缀
   - 其他文件名带 `sim_分数_` 前缀

2. **unique/** - 独特款式
   - 不与任何其他鞋子相似的款式
   - 这些是完全独特的设计

3. **group_info.json** - 每组的详细信息
   ```json
   {
     "group_id": 0,
     "type": "duplicate",
     "total_images": 3,
     "representative": {...},
     "similar_images": [...]
   }
   ```

## 常见问题 (FAQ)

### Q: 程序运行很慢？
A: 使用 `--no-bg-removal` 跳过背景移除，或者分批处理

### Q: 如何调整相似度判定？
A: 使用 `--duplicate-threshold` 和 `--similar-threshold` 参数

### Q: 输出文件夹已存在？
A: 程序会覆盖已存在的输出文件夹

### Q: 支持哪些图片格式？
A: JPG, JPEG, PNG, BMP, WEBP

### Q: 第一次运行很慢？
A: 第一次运行会下载AI模型（约500MB），之后会快很多

## 技术支持

如有问题，请查看：
- README.md - 详细技术文档
- config.json - 配置文件说明
