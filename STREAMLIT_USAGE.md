# Streamlit Web UI 使用指南

## 快速启动

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 构建索引（自动去重）

```bash
# 基本用法（会自动去除重复图片）
python build_index.py <图片文件夹> -o index

# 示例
python build_index.py E:\shoes\my_images -o index

# 如果不想去重，保留所有图片
python build_index.py E:\shoes\my_images -o index --skip-dedup

# 使用 GPU 加速（如果有 NVIDIA GPU）
python build_index.py E:\shoes\my_images -o index --gpu
```

**去重说明：**
- 默认会自动检测并移除完全相同的图片（基于文件内容的 MD5 哈希）
- 去重过程会显示找到的重复图片
- 只保留每组重复图片中的第一张
- 如果需要保留所有图片（包括重复的），使用 `--skip-dedup` 参数

### 3. 启动应用

```bash
streamlit run streamlit_app.py
```

应用将在 http://localhost:8501 启动

## 功能说明

### 主页
- 显示系统状态（索引是否加载、图片总数）
- 显示最近搜索次数
- 快速搜索入口
- 导航到各功能页面

### 🔍 图片搜索
- 上传单张图片
- 设置搜索参数：
  - 返回结果数量（1-50）
  - 最低相似度（0-1）
- 查看搜索结果（网格布局）
- 自动保存到搜索历史

### 📦 批量搜索
- 一次上传多张图片（最多 20 张）
- 显示处理进度
- 结果以标签页形式展示
- 每个查询图片独立显示结果

### ⚙️ 索引管理
- 查看当前索引状态
- 构建新索引：
  - 输入图片文件夹路径
  - 点击"构建索引"
  - 等待完成后刷新页面
- 查看索引中的随机样本图片

### 📊 结果对比
- 从搜索历史中选择 2-4 个查询
- 并排对比搜索结果
- 查看共同结果
- 查看每个查询的独特结果

## 注意事项

1. **首次使用**：需要先到"索引管理"页面构建索引
2. **索引路径**：默认索引保存在 `index/` 目录
3. **搜索历史**：保存在 `data/search_history.db`
4. **上传文件**：临时文件保存在 `uploads/temp/`，7天后自动清理
5. **支持格式**：PNG, JPG, JPEG, BMP, WEBP

## 配置

编辑 `config.yaml` 可以修改：
- 端口号
- 最大上传大小
- 索引路径
- 搜索默认参数
- 批量搜索最大数量
- 临时文件保留天数

## 故障排除

### 索引未加载
- 检查 `index/` 目录是否存在
- 检查 `index/faiss.index` 和 `index/index_data.pkl` 是否存在
- 到"索引管理"页面重新构建索引

### 搜索失败
- 确保索引已正确加载
- 检查上传的图片格式是否支持
- 查看错误信息

### 页面无法访问
- 确保 Streamlit 正在运行
- 检查端口 8501 是否被占用
- 尝试刷新浏览器

## 性能建议

- 索引构建：首次构建可能需要几分钟到几小时（取决于图片数量）
- 搜索速度：通常在 10-100ms 内完成
- 批量搜索：20 张图片约需 1-2 秒
- 内存占用：索引会加载到内存，大规模数据集需要足够的 RAM
